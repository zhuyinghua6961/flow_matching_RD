# V4 å¾®è°ƒé…ç½®æ–‡ä»¶
# ä¸¤é˜¶æ®µè®­ç»ƒï¼šåŸºäºé¢„è®­ç»ƒæ¨¡å‹ï¼Œç”¨GANä¸“é—¨ä¼˜åŒ–å¤šæ™®å‹’æ•ˆåº”

# ========== æ¨¡å‹é…ç½®ï¼ˆä¸é¢„è®­ç»ƒæ¨¡å‹ä¿æŒä¸€è‡´ï¼‰==========
model:
  base_channels: 64
  channel_mult: [1, 2, 4, 8]
  time_embed_dim: 256
  num_res_blocks: 2
  attention_levels: []
  dropout: 0.1

# ========== æ•°æ®é…ç½® ==========
data:
  train_root: "../new_dataset/train"
  val_root: "../new_dataset/val"
  test_root: "../new_dataset/test"
  
  image_size: 512
  channels: 1
  augment: false               # ğŸ”§ GANå¾®è°ƒå¿…é¡»å…³é—­æ•°æ®å¢å¼ºï¼
  
  normalize_mean: 0.35
  normalize_std: 0.06

# ========== Lossé…ç½® ==========
loss:
  # é¢‘åŸŸLossï¼ˆä¿æŒåŸæœ‰èƒ½åŠ›ï¼‰
  use_frequency: true
  frequency_weight: 3
  
  # SSIM Lossï¼ˆå¯é€‰ï¼Œå»ºè®®å…³é—­ä»¥ä¸“æ³¨å¤šæ™®å‹’ï¼‰
  use_ssim: false
  ssim_weight: 0.0

# ========== åˆ¤åˆ«å™¨é…ç½® ==========
discriminator:
  base_channels: 64          # åˆ¤åˆ«å™¨åŸºç¡€é€šé“æ•°
  dropout: 0.6               # ğŸ”§ Dropoutæ¦‚ç‡ï¼ˆå¤§å¹…æé«˜ï¼Œè®©åˆ¤åˆ«å™¨"å¥å¿˜"ï¼‰

# ========== å¾®è°ƒé…ç½®ï¼ˆæ ¸å¿ƒï¼‰â­â­â­â­â­ ==========
finetune:
  # è®­ç»ƒè½®æ•°ï¼ˆå¾®è°ƒä¸éœ€è¦å¤ªå¤šepochï¼‰
  num_epochs: 500
  
  # å­¦ä¹ ç‡ï¼ˆæ¯”é¢„è®­ç»ƒä½ï¼‰
  lr_generator: 2e-5         # â¬‡ï¸ ç”Ÿæˆå™¨å­¦ä¹ ç‡ï¼ˆè¿œä½äºé¢„è®­ç»ƒï¼‰
  lr_discriminator: 5e-6     # ğŸ”§ åˆ¤åˆ«å™¨å­¦ä¹ ç‡ï¼ˆæä½ï¼Œæš´åŠ›å‹åˆ¶åˆ¤åˆ«å™¨ï¼‰
  
  # GANæŸå¤±æƒé‡ï¼ˆæ¸è¿›å¼è®­ç»ƒï¼šå‰æœŸä¿å®ˆï¼Œè®©ç”Ÿæˆå™¨å…ˆçƒ­èº«ï¼‰
  gan_weight: 0.3            # ğŸ”§ GANæ€»æƒé‡ï¼ˆä¿å®ˆå¼€å§‹ï¼Œé¿å…ç¬¬ä¸€è½®å´©æºƒï¼‰
  adversarial_weight: 0.6    # ğŸ”§ å¯¹æŠ—æŸå¤±æƒé‡ï¼ˆæ¸©å’Œï¼Œç»™ç”Ÿæˆå™¨æˆé•¿ç©ºé—´ï¼‰
  feature_matching_weight: 2.0  # ğŸ”§ ç‰¹å¾åŒ¹é…æŸå¤±æƒé‡ï¼ˆç¨³å®šè®­ç»ƒï¼‰
  
  # åˆ¤åˆ«å™¨æ›´æ–°é¢‘ç‡
  discriminator_update_freq: 8  # ğŸ”§ æ¯8æ­¥æ›´æ–°ä¸€æ¬¡åˆ¤åˆ«å™¨ï¼ˆå¤§å¹…å‡å°‘æ›´æ–°ï¼Œè®©ç”Ÿæˆå™¨å…ˆè·‘ï¼‰
  
  # ODEæ¨ç†é…ç½®
  ode_steps: 20              # ğŸ”§ è®­ç»ƒæ—¶ODEæ¨ç†æ­¥æ•°ï¼ˆå½±å“ç”Ÿæˆè´¨é‡vsé€Ÿåº¦å¹³è¡¡ï¼‰
  ode_method: "euler"        # ODEæ±‚è§£æ–¹æ³•ï¼ˆeuler/rk4ç­‰ï¼‰
  
  # å‚æ•°å†»ç»“ç­–ç•¥
  freeze_mode: "selective"   # é€‰é¡¹ï¼š'all_trainable', 'freeze_encoder', 'selective'
  # - all_trainable: æ‰€æœ‰å‚æ•°å¯è®­ç»ƒï¼ˆä¸æ¨èï¼‰
  # - freeze_encoder: å†»ç»“ç¼–ç å™¨ï¼Œå…¶ä»–å¯è®­ç»ƒ
  # - selective: é€‰æ‹©æ€§å¾®è°ƒï¼ˆæ¨èâ­â­â­â­â­ï¼‰
  #   * å†»ç»“ï¼šç¼–ç å™¨ã€æ—¶é—´åµŒå…¥ã€UNetä½é¢‘å±‚
  #   * å¯è®­ç»ƒï¼šUNeté«˜é¢‘å±‚ï¼ˆå¤šæ™®å‹’ç›¸å…³ï¼‰
  
  # æ—©åœæœºåˆ¶
  early_stopping:
    enabled: true
    patience: 20
    min_delta: 0.0001
    monitor: "val_loss"
  
  # å­¦ä¹ ç‡è°ƒåº¦å™¨
  lr_scheduler:
    enabled: true
    factor: 0.8           # ğŸ”§ å­¦ä¹ ç‡è¡°å‡å› å­ï¼ˆæ›´æ¸©å’Œï¼‰
    patience: 15          # ğŸ”§ éªŒè¯æŸå¤±Nä¸ªepochä¸æ”¹å–„å°±é™ä½å­¦ä¹ ç‡ï¼ˆæ›´å®½å®¹ï¼‰
    min_lr: 1e-7          # æœ€å°å­¦ä¹ ç‡

  # ========== ä¸‰é˜¶æ®µæ¸è¿›å¼è®­ç»ƒ ==========
  progressive_training:
    enabled: true        # ğŸ”§ æ˜¯å¦å¯ç”¨ä¸‰é˜¶æ®µè®­ç»ƒï¼ˆtrue/falseï¼‰
    
    # é˜¶æ®µ1ï¼šç”Ÿæˆå™¨é¢„çƒ­æœŸï¼ˆä¸“æ³¨é¢‘åŸŸé‡å»ºï¼Œæ— å¯¹æŠ—å‹åŠ›ï¼‰
    stage1:
      epochs: [1, 15]     # epochèŒƒå›´ï¼š1-15
      gan_weight: 0.0     # å®Œå…¨å…³é—­GANæŸå¤±
      adversarial_weight: 0.0
      feature_matching_weight: 0.0
      lr_discriminator: 0.0  # åˆ¤åˆ«å™¨ä¸æ›´æ–°
      frequency_weight: 5.0  # å¼ºåŒ–é¢‘åŸŸå­¦ä¹ 
      description: "ç”Ÿæˆå™¨é¢„çƒ­ï¼šä¸“æ³¨å¤šæ™®å‹’é¢‘åŸŸé‡å»ºï¼Œæ— å¯¹æŠ—å¹²æ‰°"
    
    # é˜¶æ®µ2ï¼šæ¸©å’Œå¯¹æŠ—æœŸï¼ˆè½»å¾®å¯¹æŠ—å‹åŠ›ï¼Œå»ºç«‹åˆæ­¥å¹³è¡¡ï¼‰
    stage2:
      epochs: [16, 30]    # epochèŒƒå›´ï¼š16-30
      gan_weight: 0.15    # ğŸ”§ æé«˜GANæƒé‡ï¼Œå¢å¼ºå¯¹æŠ—ä¿¡å·
      adversarial_weight: 0.3  # ğŸ”§ æé«˜å¯¹æŠ—æƒé‡
      feature_matching_weight: 0.4  # ğŸ”§ æé«˜ç‰¹å¾åŒ¹é…æƒé‡
      lr_discriminator: 5e-7  # ğŸ”§ è¿›ä¸€æ­¥é™ä½åˆ¤åˆ«å™¨å­¦ä¹ ç‡
      discriminator_update_freq: 10  # ğŸ”§ ä¿®å¤ï¼šç¡®ä¿æ¯ä¸ªepochéƒ½æœ‰åˆ¤åˆ«å™¨æ›´æ–°
      frequency_weight: 2.5  # ğŸ”§ é€‚åº¦é™ä½é¢‘åŸŸæƒé‡ï¼Œå¹³è¡¡å¯¹æŠ—
      description: "æ¸©å’Œå¯¹æŠ—ï¼šç”Ÿæˆå™¨é€æ­¥é€‚åº”å¯¹æŠ—ç¯å¢ƒ"
    
    # é˜¶æ®µ3ï¼šæ­£å¸¸å¯¹æŠ—æœŸï¼ˆæ­£å¸¸GANè®­ç»ƒï¼‰
    stage3:
      epochs: [31, 999]   # epochèŒƒå›´ï¼š31åŠä»¥å
      gan_weight: 0.25    # ğŸ”§ æé«˜GANæƒé‡ï¼Œæ¥è¿‘åŸºç¡€é…ç½®
      adversarial_weight: 0.4  # ğŸ”§ æé«˜å¯¹æŠ—æƒé‡
      feature_matching_weight: 0.5  # ğŸ”§ æé«˜ç‰¹å¾åŒ¹é…æƒé‡
      lr_discriminator: 2e-6  # ğŸ”§ é™ä½åˆ¤åˆ«å™¨å­¦ä¹ ç‡ï¼Œæ¯”åŸºç¡€é…ç½®æ›´ä¿å®ˆ
      discriminator_update_freq: 8   # ğŸ”§ ä¿®å¤ï¼šç¡®ä¿æ¯ä¸ªepochéƒ½æœ‰è¶³å¤Ÿçš„åˆ¤åˆ«å™¨æ›´æ–°
      frequency_weight: 2.0  # ğŸ”§ æé«˜é¢‘åŸŸæƒé‡ï¼Œä¿æŒå¹³è¡¡
      description: "æ­£å¸¸å¯¹æŠ—ï¼šæ ‡å‡†GANè®­ç»ƒæ¨¡å¼"

# ========== è®­ç»ƒé…ç½® ==========
train:
  batch_size: 2
  num_workers: 4
  
  # æ¢¯åº¦ç´¯ç§¯ï¼ˆè§£å†³batch=1æ—¶å‡†ç¡®ç‡åªæœ‰0/1çš„é—®é¢˜ï¼‰
  gradient_accumulation_steps: 4  # ç´¯ç§¯4æ­¥=ç­‰æ•ˆbatch_size=4
  
  # ä¼˜åŒ–å™¨
  betas: [0.9, 0.999]
  weight_decay: 0.01
  
  # æ¢¯åº¦è£å‰ª
  max_grad_norm: 1.0
  
  # è®¾å¤‡
  device: "cuda"
  
  # ä¿å­˜å’Œæ—¥å¿—
  save_interval: 5           # æ¯Nä¸ªepochä¿å­˜æ£€æŸ¥ç‚¹
  log_interval: 10           # æ¯Nä¸ªiterationæ‰“å°æ—¥å¿—
  keep_last_n_checkpoints: 5 # åªä¿ç•™æœ€è¿‘Nä¸ªæ£€æŸ¥ç‚¹ï¼ˆèŠ‚çœç©ºé—´ï¼‰

# ========== è·¯å¾„é…ç½® ==========
paths:
  # é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼ˆV4å¾®è°ƒéœ€è¦ï¼‰
  pretrained_model: "../trained_models/GAN/three_stage_train/checkpoints/best_finetuned.pth"
  
  # è¾“å‡ºè·¯å¾„
  output_dir: "../trained_models/GAN/1114/results"
  log_dir: "../trained_models/GAN/1114/logs"
  checkpoint_dir: "../trained_models/GAN/1114/checkpoints"

# ========================================================================
# ä½¿ç”¨è¯´æ˜ - V4 æ¸è¿›å¼å¾®è°ƒç‰ˆæœ¬
# ========================================================================
#
# ã€è®­ç»ƒæµç¨‹ã€‘ï¼š
# 
# é˜¶æ®µ1ï¼šé¢„è®­ç»ƒåŸºç¡€æ¨¡å‹ï¼ˆå¤–éƒ¨å®Œæˆï¼‰
#   python train_v3.py --config config_v2.yaml
#   å¾—åˆ°ï¼štrained_models/outputs/checkpoints/best_model.pth
#
# é˜¶æ®µ2ï¼šå¾®è°ƒå¤šæ™®å‹’æ•ˆåº”ï¼ˆæœ¬é…ç½®ï¼‰
#   æ–¹å¼1ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
#     python v4_finetune/train_finetune.py --config v4_finetune/config_finetune.yaml
#   
#   æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
#     python v4_finetune/train_finetune.py \
#         --config v4_finetune/config_finetune.yaml \
#         --pretrained /path/to/your/pretrained_model.pth
#
# ã€ä¸‰é˜¶æ®µæ¸è¿›å¼è®­ç»ƒã€‘ï¼š
# å¯ç”¨æ–¹æ³•ï¼šè®¾ç½® progressive_training.enabled: true
# 
# Stage 1 (Epoch 1-15)ï¼šç”Ÿæˆå™¨é¢„çƒ­æœŸ
#   - å®Œå…¨å…³é—­GANæŸå¤±ï¼Œä¸“æ³¨é¢‘åŸŸé‡å»º
#   - åˆ¤åˆ«å™¨ä¸å‚ä¸è®­ç»ƒ
#   - è®©ç”Ÿæˆå™¨å……åˆ†å­¦ä¹ å¤šæ™®å‹’åŸºç¡€æ¨¡å¼
#   - é¢„æœŸï¼šé¢‘åŸŸæŸå¤±ç¨³å®šä¸‹é™ï¼Œç”Ÿæˆè´¨é‡æ”¹å–„
# 
# Stage 2 (Epoch 16-30)ï¼šæ¸©å’Œå¯¹æŠ—æœŸ  
#   - æä½çš„å¯¹æŠ—æƒé‡ï¼Œè½»å¾®å¯¹æŠ—å‹åŠ›
#   - åˆ¤åˆ«å™¨å­¦ä¹ ç‡æä½ï¼Œæ›´æ–°é¢‘ç‡å¾ˆä½
#   - ç”Ÿæˆå™¨é€æ­¥é€‚åº”å¯¹æŠ—ç¯å¢ƒ
#   - é¢„æœŸï¼šå‡†ç¡®ç‡ Real=0.6-0.7, Fake=0.4-0.5
# 
# Stage 3 (Epoch 31+)ï¼šæ­£å¸¸å¯¹æŠ—æœŸ
#   - æ¢å¤æ­£å¸¸GANè®­ç»ƒå‚æ•°
#   - åœ¨ç”Ÿæˆå™¨æœ‰åŸºç¡€èƒ½åŠ›åè¿›è¡Œæ ‡å‡†å¯¹æŠ—
#   - é¢„æœŸï¼šç¨³å®šçš„Nashå‡è¡¡çŠ¶æ€
#
# ã€æ ¸å¿ƒç‰¹ç‚¹ã€‘ï¼š
# 1. âœ… åŸºäºé¢„è®­ç»ƒæ¨¡å‹ï¼ˆåŸºç¡€èƒ½åŠ›å·²å…·å¤‡ï¼‰
# 2. âœ… åˆ¤åˆ«å™¨åªå…³æ³¨å¤šæ™®å‹’åŒºåŸŸï¼ˆä¸å½±å“èƒŒæ™¯ï¼‰
# 3. âœ… é€‰æ‹©æ€§å‚æ•°æ›´æ–°ï¼ˆå†»ç»“å¤§éƒ¨åˆ†ï¼Œåªå¾®è°ƒå¤šæ™®å‹’ç›¸å…³ï¼‰
# 4. âœ… ä½å­¦ä¹ ç‡å¾®è°ƒï¼ˆç¨³å®šï¼Œä¸ç ´åå·²æœ‰èƒ½åŠ›ï¼‰
# 5. âœ… å¿«é€Ÿæ”¶æ•›ï¼ˆ50ä¸ªepochè¶³å¤Ÿï¼‰
#
# ã€å‚æ•°å†»ç»“ç­–ç•¥ã€‘ï¼š
# freeze_mode: "selective"ï¼ˆæ¨èï¼‰
#   å†»ç»“ï¼š
#     - SimEncoderï¼ˆç¼–ç å™¨ï¼‰â†’ èƒŒæ™¯ç‰¹å¾å·²å­¦å¥½
#     - Time Embedding â†’ å·²å­¦å¥½
#     - UNetå‰ä¸¤å±‚ï¼ˆä½é¢‘ï¼‰ â†’ æ•´ä½“ç»“æ„å·²ç¨³å®š
#   
#   å¯è®­ç»ƒï¼š
#     - UNetåä¸¤å±‚ï¼ˆé«˜é¢‘ï¼‰ â†’ å¤šæ™®å‹’ç›¸å…³ï¼Œéœ€è¦æ”¹è¿›
#     - å…¶ä»–ä¸­é—´å±‚ â†’ é€‚åº¦è°ƒæ•´
#
# ã€é¢„æœŸæ•ˆæœã€‘ï¼š
# - å¤šæ™®å‹’åå­—ï¼šæ˜¾è‘—æ”¹å–„
# - èƒŒæ™¯ï¼šå®Œå…¨ä¸å˜
# - æ•´ä½“ç»“æ„ï¼šä¿æŒç¨³å®š
# - é¢‘åŸŸç›¸å…³ç³»æ•°ï¼š0.75 â†’ 0.85+
# - ç»¼åˆè¯„åˆ†ï¼š78 â†’ 88+
#
# ã€è°ƒå‚å»ºè®®ã€‘ï¼š
# 
# ğŸ”§ å¸¸è§„è®­ç»ƒè°ƒå‚ï¼š
# 1. å¦‚æœå¤šæ™®å‹’æ”¹å–„ä¸æ˜æ˜¾ï¼š
#    - æé«˜gan_weightåˆ°0.8
#    - æé«˜lr_generatoråˆ°2e-5
#
# 2. å¦‚æœèƒŒæ™¯è¢«å½±å“ï¼š
#    - é™ä½lr_generatoråˆ°5e-6
#    - æ”¹freeze_modeä¸º'freeze_encoder'
#
# 3. å¦‚æœåˆ¤åˆ«å™¨å¤ªå¼ºï¼š
#    - é™ä½lr_discriminatoråˆ°1e-4
#    - å¢åŠ discriminator_update_freqåˆ°2
#
# 4. å¦‚æœåˆ¤åˆ«å™¨å¤ªå¼±ï¼š
#    - æé«˜lr_discriminatoråˆ°3e-4
#    - é™ä½åˆ¤åˆ«å™¨dropoutåˆ°0.2
#
# ğŸš€ ä¸‰é˜¶æ®µè®­ç»ƒè°ƒå‚ï¼š
# 1. å¦‚æœStage1é¢‘åŸŸæŸå¤±ä¸ä¸‹é™ï¼š
#    - æé«˜stage1.frequency_weightåˆ°8.0
#    - å»¶é•¿stage1.epochsåˆ°[1, 20]
#
# 2. å¦‚æœStage2/3åˆ¤åˆ«å™¨è¿‡å¼ºï¼ˆReal=1.0, Fake=0.0ï¼‰ï¼š
#    â­ æ¿€è¿›æŠ‘åˆ¶ç­–ç•¥ï¼š
#    - é™ä½lr_discriminatorï¼šstage2ç”¨3e-7, stage3ç”¨1e-6
#    - å¢åŠ update_freqï¼šstage2ç”¨40, stage3ç”¨20
#    - æé«˜gan_weightï¼šstage2ç”¨0.2, stage3ç”¨0.3
#    - æ·»åŠ åˆ¤åˆ«å™¨dropoutï¼šåœ¨discriminatorä¸­å¢åŠ dropout=0.5
#
# 3. å¦‚æœç”Ÿæˆå™¨å­¦ä¹ å¤ªæ…¢ï¼š
#    - æé«˜lr_generatoråˆ°3e-5
#    - é™ä½frequency_weightï¼Œå¢åŠ å¯¹æŠ—æƒé‡æ¯”ä¾‹
#    - å»¶é•¿stage2çš„epochèŒƒå›´åˆ°[16, 40]
#
# 4. å¦‚æœè®­ç»ƒä¸ç¨³å®šï¼š
#    - ä½¿ç”¨æ›´ä¿å®ˆçš„å­¦ä¹ ç‡è¡°å‡
#    - å¢åŠ æ¢¯åº¦è£å‰ªï¼šmax_grad_norm: 0.5
#    - è€ƒè™‘ä½¿ç”¨spectral normalization
#
# ========================================================================
