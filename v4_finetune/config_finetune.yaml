# V4 å¾®è°ƒé…ç½®æ–‡ä»¶
# ä¸¤é˜¶æ®µè®­ç»ƒï¼šåŸºäºé¢„è®­ç»ƒæ¨¡å‹ï¼Œç”¨GANä¸“é—¨ä¼˜åŒ–å¤šæ™®å‹’æ•ˆåº”

# ========== æ¨¡å‹é…ç½®ï¼ˆä¸é¢„è®­ç»ƒæ¨¡å‹ä¿æŒä¸€è‡´ï¼‰==========
model:
  base_channels: 64
  channel_mult: [1, 2, 4, 8]
  time_embed_dim: 256
  num_res_blocks: 2
  attention_levels: []
  dropout: 0.1

# ========== æ•°æ®é…ç½® ==========
data:
  train_root: "../new_dataset/train"
  val_root: "../new_dataset/val"
  test_root: "../new_dataset/test"
  
  image_size: 512
  channels: 1
  augment: true
  
  normalize_mean: 0.35
  normalize_std: 0.06

# ========== Lossé…ç½® ==========
loss:
  # é¢‘åŸŸLossï¼ˆä¿æŒåŸæœ‰èƒ½åŠ›ï¼‰
  use_frequency: true
  frequency_weight: 1.5
  
  # SSIM Lossï¼ˆå¯é€‰ï¼Œå»ºè®®å…³é—­ä»¥ä¸“æ³¨å¤šæ™®å‹’ï¼‰
  use_ssim: false
  ssim_weight: 0.0

# ========== åˆ¤åˆ«å™¨é…ç½® ==========
discriminator:
  base_channels: 64          # åˆ¤åˆ«å™¨åŸºç¡€é€šé“æ•°
  dropout: 0.3               # Dropoutæ¦‚ç‡ï¼ˆé˜²æ­¢åˆ¤åˆ«å™¨è¿‡æ‹Ÿåˆï¼‰

# ========== å¾®è°ƒé…ç½®ï¼ˆæ ¸å¿ƒï¼‰â­â­â­â­â­ ==========
finetune:
  # è®­ç»ƒè½®æ•°ï¼ˆå¾®è°ƒä¸éœ€è¦å¤ªå¤šepochï¼‰
  num_epochs: 500
  
  # å­¦ä¹ ç‡ï¼ˆæ¯”é¢„è®­ç»ƒä½ï¼‰
  lr_generator: 2e-5         # â¬‡ï¸ ç”Ÿæˆå™¨å­¦ä¹ ç‡ï¼ˆè¿œä½äºé¢„è®­ç»ƒï¼‰
  lr_discriminator: 2e-5     # ğŸ”§ åˆ¤åˆ«å™¨å­¦ä¹ ç‡ï¼ˆé™ä½ï¼Œé¿å…åˆ¤åˆ«å™¨è¿‡å¼ºï¼‰
  
  # GANæŸå¤±æƒé‡
  gan_weight: 0.6            # ğŸ”§ GANæ€»æƒé‡ï¼ˆé™ä½ï¼Œè®©FMå’Œé¢‘åŸŸå ä¸»å¯¼ï¼‰
  adversarial_weight: 1.0    # ğŸ”§ å¯¹æŠ—æŸå¤±æƒé‡ï¼ˆé™ä½ï¼‰
  feature_matching_weight: 2.0  # ğŸ”§ ç‰¹å¾åŒ¹é…æŸå¤±æƒé‡ï¼ˆæé«˜ï¼Œæ›´ç¨³å®šï¼‰
  
  # åˆ¤åˆ«å™¨æ›´æ–°é¢‘ç‡
  discriminator_update_freq: 3  # ğŸ”§ æ¯5æ­¥æ›´æ–°ä¸€æ¬¡åˆ¤åˆ«å™¨ï¼ˆé¿å…åˆ¤åˆ«å™¨è¿‡å¼ºï¼‰
  
  # å‚æ•°å†»ç»“ç­–ç•¥
  freeze_mode: "selective"   # é€‰é¡¹ï¼š'all_trainable', 'freeze_encoder', 'selective'
  # - all_trainable: æ‰€æœ‰å‚æ•°å¯è®­ç»ƒï¼ˆä¸æ¨èï¼‰
  # - freeze_encoder: å†»ç»“ç¼–ç å™¨ï¼Œå…¶ä»–å¯è®­ç»ƒ
  # - selective: é€‰æ‹©æ€§å¾®è°ƒï¼ˆæ¨èâ­â­â­â­â­ï¼‰
  #   * å†»ç»“ï¼šç¼–ç å™¨ã€æ—¶é—´åµŒå…¥ã€UNetä½é¢‘å±‚
  #   * å¯è®­ç»ƒï¼šUNeté«˜é¢‘å±‚ï¼ˆå¤šæ™®å‹’ç›¸å…³ï¼‰
  
  # æ—©åœæœºåˆ¶
  early_stopping:
    enabled: true
    patience: 20
    min_delta: 0.0001
    monitor: "val_loss"
  
  # å­¦ä¹ ç‡è°ƒåº¦å™¨
  lr_scheduler:
    enabled: true
    factor: 0.8           # ğŸ”§ å­¦ä¹ ç‡è¡°å‡å› å­ï¼ˆæ›´æ¸©å’Œï¼‰
    patience: 15          # ğŸ”§ éªŒè¯æŸå¤±Nä¸ªepochä¸æ”¹å–„å°±é™ä½å­¦ä¹ ç‡ï¼ˆæ›´å®½å®¹ï¼‰
    min_lr: 1e-7          # æœ€å°å­¦ä¹ ç‡

# ========== è®­ç»ƒé…ç½® ==========
train:
  batch_size: 1
  num_workers: 4
  
  # æ¢¯åº¦ç´¯ç§¯ï¼ˆè§£å†³batch=1æ—¶å‡†ç¡®ç‡åªæœ‰0/1çš„é—®é¢˜ï¼‰
  gradient_accumulation_steps: 8  # ç´¯ç§¯4æ­¥=ç­‰æ•ˆbatch_size=4
  
  # ä¼˜åŒ–å™¨
  betas: [0.9, 0.999]
  weight_decay: 0.01
  
  # æ¢¯åº¦è£å‰ª
  max_grad_norm: 1.0
  
  # è®¾å¤‡
  device: "cuda"
  
  # ä¿å­˜å’Œæ—¥å¿—
  save_interval: 5           # æ¯Nä¸ªepochä¿å­˜æ£€æŸ¥ç‚¹
  log_interval: 10           # æ¯Nä¸ªiterationæ‰“å°æ—¥å¿—
  keep_last_n_checkpoints: 5 # åªä¿ç•™æœ€è¿‘Nä¸ªæ£€æŸ¥ç‚¹ï¼ˆèŠ‚çœç©ºé—´ï¼‰

# ========== è·¯å¾„é…ç½® ==========
paths:
  # é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼ˆV4å¾®è°ƒéœ€è¦ï¼‰
  pretrained_model: "../trained_models/outputs1110/checkpoints/best_model.pth"
  
  # è¾“å‡ºè·¯å¾„
  output_dir: "../trained_models/v4_1112/results"
  log_dir: "../trained_models/v4_1112/logs"
  checkpoint_dir: "../trained_models/v4_1112/checkpoints"

# ========================================================================
# ä½¿ç”¨è¯´æ˜ - V4 ä¸¤é˜¶æ®µå¾®è°ƒç‰ˆæœ¬
# ========================================================================
#
# ã€è®­ç»ƒæµç¨‹ã€‘ï¼š
# 
# é˜¶æ®µ1ï¼šé¢„è®­ç»ƒåŸºç¡€æ¨¡å‹ï¼ˆå¤–éƒ¨å®Œæˆï¼‰
#   python train_v3.py --config config_v2.yaml
#   å¾—åˆ°ï¼štrained_models/outputs/checkpoints/best_model.pth
#
# é˜¶æ®µ2ï¼šå¾®è°ƒå¤šæ™®å‹’æ•ˆåº”ï¼ˆæœ¬é…ç½®ï¼‰
#   æ–¹å¼1ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
#     python v4_finetune/train_finetune.py --config v4_finetune/config_finetune.yaml
#   
#   æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
#     python v4_finetune/train_finetune.py \
#         --config v4_finetune/config_finetune.yaml \
#         --pretrained /path/to/your/pretrained_model.pth
#
# ã€æ ¸å¿ƒç‰¹ç‚¹ã€‘ï¼š
# 1. âœ… åŸºäºé¢„è®­ç»ƒæ¨¡å‹ï¼ˆåŸºç¡€èƒ½åŠ›å·²å…·å¤‡ï¼‰
# 2. âœ… åˆ¤åˆ«å™¨åªå…³æ³¨å¤šæ™®å‹’åŒºåŸŸï¼ˆä¸å½±å“èƒŒæ™¯ï¼‰
# 3. âœ… é€‰æ‹©æ€§å‚æ•°æ›´æ–°ï¼ˆå†»ç»“å¤§éƒ¨åˆ†ï¼Œåªå¾®è°ƒå¤šæ™®å‹’ç›¸å…³ï¼‰
# 4. âœ… ä½å­¦ä¹ ç‡å¾®è°ƒï¼ˆç¨³å®šï¼Œä¸ç ´åå·²æœ‰èƒ½åŠ›ï¼‰
# 5. âœ… å¿«é€Ÿæ”¶æ•›ï¼ˆ50ä¸ªepochè¶³å¤Ÿï¼‰
#
# ã€å‚æ•°å†»ç»“ç­–ç•¥ã€‘ï¼š
# freeze_mode: "selective"ï¼ˆæ¨èï¼‰
#   å†»ç»“ï¼š
#     - SimEncoderï¼ˆç¼–ç å™¨ï¼‰â†’ èƒŒæ™¯ç‰¹å¾å·²å­¦å¥½
#     - Time Embedding â†’ å·²å­¦å¥½
#     - UNetå‰ä¸¤å±‚ï¼ˆä½é¢‘ï¼‰ â†’ æ•´ä½“ç»“æ„å·²ç¨³å®š
#   
#   å¯è®­ç»ƒï¼š
#     - UNetåä¸¤å±‚ï¼ˆé«˜é¢‘ï¼‰ â†’ å¤šæ™®å‹’ç›¸å…³ï¼Œéœ€è¦æ”¹è¿›
#     - å…¶ä»–ä¸­é—´å±‚ â†’ é€‚åº¦è°ƒæ•´
#
# ã€é¢„æœŸæ•ˆæœã€‘ï¼š
# - å¤šæ™®å‹’åå­—ï¼šæ˜¾è‘—æ”¹å–„
# - èƒŒæ™¯ï¼šå®Œå…¨ä¸å˜
# - æ•´ä½“ç»“æ„ï¼šä¿æŒç¨³å®š
# - é¢‘åŸŸç›¸å…³ç³»æ•°ï¼š0.75 â†’ 0.85+
# - ç»¼åˆè¯„åˆ†ï¼š78 â†’ 88+
#
# ã€è°ƒå‚å»ºè®®ã€‘ï¼š
# 1. å¦‚æœå¤šæ™®å‹’æ”¹å–„ä¸æ˜æ˜¾ï¼š
#    - æé«˜gan_weightåˆ°0.8
#    - æé«˜lr_generatoråˆ°2e-5
#
# 2. å¦‚æœèƒŒæ™¯è¢«å½±å“ï¼š
#    - é™ä½lr_generatoråˆ°5e-6
#    - æ”¹freeze_modeä¸º'freeze_encoder'
#
# 3. å¦‚æœåˆ¤åˆ«å™¨å¤ªå¼ºï¼š
#    - é™ä½lr_discriminatoråˆ°1e-4
#    - å¢åŠ discriminator_update_freqåˆ°2
#
# 4. å¦‚æœåˆ¤åˆ«å™¨å¤ªå¼±ï¼š
#    - æé«˜lr_discriminatoråˆ°3e-4
#    - é™ä½åˆ¤åˆ«å™¨dropoutåˆ°0.2
#
# ========================================================================
