# ========================================================================
# V5 WGAN-GPé…ç½®æ–‡ä»¶
# åŸºäºV4é…ç½®ï¼Œä¸“é—¨é’ˆå¯¹WGAN-GPä¼˜åŒ–
# ========================================================================

# ========== è®¾å¤‡é…ç½® ==========
device: "cuda:0"

# ========== æ¨¡å‹é…ç½® ==========
model:
  base_channels: 64
  channel_mult: [1, 2, 4, 8]
  time_embed_dim: 256
  num_res_blocks: 2
  attention_levels: []  # æš‚æ—¶å…³é—­attentionä»¥æé«˜è®­ç»ƒé€Ÿåº¦
  dropout: 0.1

# ========== WGAN-GP Criticé…ç½® ==========
critic:
  base_channels: 96          # ğŸ”§ ä»64å¢åŠ åˆ°96ï¼Œæé«˜Criticåˆ¤åˆ«èƒ½åŠ›
  dropout: 0.2               # ğŸ”§ ä»0.3é™ä½åˆ°0.2ï¼Œå‡å°‘è¿‡åº¦æ­£åˆ™åŒ–

# ========== å¾®è°ƒé…ç½®ï¼ˆWGAN-GPç‰ˆæœ¬ï¼‰â­â­â­â­â­ ==========
finetune:
  # è®­ç»ƒè½®æ•°
  num_epochs: 200
  
  # å­¦ä¹ ç‡ï¼ˆä¿®å¤åçš„å¹³è¡¡è®¾ç½®ï¼‰
  lr_generator: 3e-5         # ğŸ”§ ç”Ÿæˆå™¨å­¦ä¹ ç‡ï¼ˆä¿æŒä¸å˜ï¼‰
  lr_critic: 5e-5            # ğŸ”§ Criticå­¦ä¹ ç‡ï¼ˆä»1e-4é™ä½åˆ°5e-5ï¼Œé¿å…è¿‡åº¦å­¦ä¹ ï¼‰
  
  # WGAN-GPç‰¹æœ‰å‚æ•°ï¼ˆV5.2 å†æ¬¡è°ƒæ•´ï¼‰
  wgan_weight: 1.0           # ğŸ”§ WGANæŸå¤±æƒé‡ï¼ˆä¿æŒ1.0ï¼‰
  lambda_gp: 5.0             # ğŸ”§ æ¢¯åº¦æƒ©ç½šç³»æ•°ï¼ˆä»2.0è°ƒåˆ°5.0ï¼Œå¯»æ‰¾å¹³è¡¡ç‚¹ï¼‰
  feature_matching_weight: 1.0  # ğŸ”§ ç‰¹å¾åŒ¹é…æŸå¤±æƒé‡
  
  # Criticæ›´æ–°é¢‘ç‡ï¼ˆè¿›ä¸€æ­¥å¢åŠ å­¦ä¹ æœºä¼šï¼‰
  critic_update_freq: 1      # ğŸ”§ æ¯1æ­¥æ›´æ–°ä¸€æ¬¡Criticï¼ˆä»2é™åˆ°1ï¼‰
  
  # ODEæ¨ç†é…ç½®
  ode_steps: 20              # ODEæ¨ç†æ­¥æ•°
  ode_method: "euler"        # ODEæ±‚è§£æ–¹æ³•
  
  # å‚æ•°å†»ç»“ç­–ç•¥
  freeze_mode: "selective"   # é€‰é¡¹ï¼š'all_trainable', 'freeze_encoder', 'selective'
  
  # å­¦ä¹ ç‡è°ƒåº¦å™¨
  lr_scheduler:
    enabled: true
    factor: 0.8              # ğŸ”§ å­¦ä¹ ç‡è¡°å‡å› å­ï¼ˆæ¯”V4æ¸©å’Œï¼‰
    patience: 15             # ğŸ”§ è€å¿ƒå€¼ï¼ˆæ¯”V4å¤§ï¼‰
    min_lr: 1e-7
  
  # æ—©åœæœºåˆ¶
  early_stopping:
    enabled: true
    patience: 30             # ğŸ”§ WGAN-GPæ›´ç¨³å®šï¼Œå¯ä»¥è®¾ç½®æ›´å¤§çš„è€å¿ƒå€¼
    min_delta: 0.0001
    monitor: "val_loss"

# ========== è®­ç»ƒé…ç½® ==========
train:
  batch_size: 2
  num_workers: 4
  
  # æ¢¯åº¦ç´¯ç§¯ï¼ˆå‡å°‘ç´¯ç§¯æ­¥æ•°ï¼Œæé«˜æ›´æ–°é¢‘ç‡ï¼‰
  gradient_accumulation_steps: 2  # ğŸ”§ ä»4é™åˆ°2ï¼Œç­‰æ•ˆbatch_size=4ï¼Œæ›´é¢‘ç¹æ›´æ–°
  
  # ä¼˜åŒ–å™¨å‚æ•°
  betas: [0.9, 0.999]        # ç”Ÿæˆå™¨Adamå‚æ•°
  weight_decay: 1e-4
  
  # æ¢¯åº¦è£å‰ªï¼ˆæ›´ä¸¥æ ¼çš„æ¢¯åº¦è£å‰ªï¼‰
  max_grad_norm: 0.5         # ğŸ”§ ä»1.0é™åˆ°0.5ï¼Œé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸
  
  # æ—¥å¿—å’Œä¿å­˜
  log_interval: 50
  save_interval: 10

# ========== æŸå¤±å‡½æ•°é…ç½® ==========
loss:
  # é¢‘åŸŸæŸå¤±
  use_frequency: true
  frequency_weight: 2.0      # ğŸ”§ é¢‘åŸŸæƒé‡ï¼ˆæ¯”V4ç¨é«˜ï¼Œå¹³è¡¡WGANï¼‰
  
  # å…¶ä»–æŸå¤±ï¼ˆä¿ç•™å…¼å®¹æ€§ï¼‰
  use_perceptual: false
  perceptual_weight: 0.1
  perceptual_layers: [2, 7, 16, 25]

# ========== æ•°æ®é…ç½® ==========
data:
  # æ•°æ®è·¯å¾„
  train_root: "../new_dataset/train"
  val_root: "../new_dataset/val"
  
  # æ•°æ®é¢„å¤„ç†
  normalize_mean: 0.35
  normalize_std: 0.06
  
  # æ•°æ®å¢å¼º
  augment: true

# ========== è·¯å¾„é…ç½® ==========
paths:
  # é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
  pretrained_model: "../trained_models/GAN/1114/checkpoints/best_finetuned.pth"
  
  # è¾“å‡ºè·¯å¾„
  output_dir: "../trained_models/WGAN_GP/v5_results"
  log_dir: "../trained_models/WGAN_GP/v5_logs"
  checkpoint_dir: "../trained_models/WGAN_GP/v5_checkpoints"

# ========================================================================
# ä½¿ç”¨è¯´æ˜ - V5 WGAN-GPç‰ˆæœ¬
# ========================================================================
#
# ğŸš€ V5æ–°ç‰¹æ€§ï¼š
# 1. WGAN-GPæ›¿ä»£ä¼ ç»ŸGANï¼šæ›´ç¨³å®šçš„å¯¹æŠ—è®­ç»ƒ
# 2. ç®€åŒ–çš„è¶…å‚æ•°ï¼šæ— éœ€å¤æ‚çš„ä¸‰é˜¶æ®µè®­ç»ƒ
# 3. æ›´é«˜çš„å­¦ä¹ ç‡ï¼šWGAN-GPæ”¯æŒæ›´æ¿€è¿›çš„å­¦ä¹ ç‡
# 4. æ ‡å‡†5:1æ›´æ–°æ¯”ä¾‹ï¼šCritic vs Generator
#
# ğŸ”§ å…³é”®å‚æ•°è¯´æ˜ï¼š
# - lr_critic: 1e-4ï¼ˆæ¯”ä¼ ç»Ÿåˆ¤åˆ«å™¨é«˜20å€ï¼‰
# - lambda_gp: 10.0ï¼ˆæ¢¯åº¦æƒ©ç½šç³»æ•°ï¼Œæ ‡å‡†å€¼ï¼‰
# - critic_update_freq: 5ï¼ˆæ ‡å‡†5:1æ¯”ä¾‹ï¼‰
# - wgan_weight: 1.0ï¼ˆå¯ä»¥ä½¿ç”¨æ ‡å‡†æƒé‡ï¼‰
#
# ğŸ“Š é¢„æœŸæ”¹è¿›ï¼š
# - æ— æ¨¡å¼å´©æºƒï¼šWGAN-GPç†è®ºä¿è¯
# - æ›´å¿«æ”¶æ•›ï¼šæ— éœ€å¤æ‚çš„æ¸è¿›å¼è®­ç»ƒ
# - æ›´ç¨³å®šçš„æ¢¯åº¦ï¼šWassersteinè·ç¦»ä¼˜åŠ¿
# - æ›´ç®€å•çš„è°ƒå‚ï¼šå‡å°‘è¶…å‚æ•°æ•æ„Ÿæ€§
#
# ğŸ¯ è®­ç»ƒç­–ç•¥ï¼š
# 1. é˜¶æ®µ1ï¼ˆ1-20 epochsï¼‰ï¼šçº¯Flow Matchingé¢„çƒ­
# 2. é˜¶æ®µ2ï¼ˆ21+ epochsï¼‰ï¼šFlow Matching + WGAN-GP
# 
# æˆ–è€…ç›´æ¥å…¨ç¨‹ä½¿ç”¨WGAN-GPï¼ˆæ¨èï¼‰
#
# ğŸš€ å¯åŠ¨å‘½ä»¤ï¼š
# python train_wgan.py --config config_wgan.yaml
#
# ========================================================================
# ğŸ”§ V5.2 ä¿®å¤ç‰ˆæœ¬æ›´æ–°æ—¥å¿— (2025-11-15)
# ========================================================================
#
# ğŸš¨ V5.1å‘ç°çš„é—®é¢˜ï¼š
# 1. WGANæŸå¤±ä»ä¸ºè´Ÿä¸”æ¶åŒ– (-0.0361 â†’ -0.2176)
# 2. CriticæŸå¤±è¿‡ä½ (0.99 vs ä¹‹å‰2.48)
# 3. æ¢¯åº¦æƒ©ç½šå¯èƒ½é™å¾—è¿‡å¤š (2.0å¯èƒ½å¤ªå°)
# 4. è¿›åº¦æ¡ç¼ºå°‘Real/Fake Scoreæ˜¾ç¤º
#
# ğŸ”§ V5.2 è¿›ä¸€æ­¥ä¿®å¤ï¼š
# - lambda_gp: 2.0 â†’ 5.0 (å¯»æ‰¾å¹³è¡¡ç‚¹ï¼Œé¿å…è¿‡åº¦/ä¸è¶³)
# - critic_update_freq: 2 â†’ 1 (æ¯æ­¥éƒ½æ›´æ–°Critic)
# - æ·»åŠ Real/Fake Scoreæ˜¾ç¤ºåˆ°è¿›åº¦æ¡
# - ä¿æŒå…¶ä»–V5.1çš„æ”¹è¿›
#
# ğŸ¯ é¢„æœŸæ”¹è¿›ï¼š
# - Criticèƒ½å¤Ÿæœ‰æ•ˆåŒºåˆ†çœŸå‡å›¾åƒ
# - WGANæŸå¤±ä»è´Ÿå€¼è½¬ä¸ºæ­£å€¼
# - Gap (Real_Score - Fake_Score) é€æ¸å¢å¤§åˆ°2-4èŒƒå›´
# - è®­ç»ƒæ›´åŠ ç¨³å®šï¼Œæ— æç«¯æ³¢åŠ¨
#
# ğŸ“Š ç›‘æ§é‡ç‚¹ï¼š
# - Real_Score åº”è¯¥ > Fake_Score
# - Gap åº”è¯¥åœ¨ 2.0-4.0 èŒƒå›´
# - Gradient_Penalty åº”è¯¥åœ¨ 2.0 é™„è¿‘
# - CriticæŸå¤±åº”è¯¥æœ‰æ˜æ˜¾å˜åŒ–è¶‹åŠ¿
#
# ========================================================================
